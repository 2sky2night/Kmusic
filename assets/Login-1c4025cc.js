import{r as p,u as L,k as V}from"./index-1f548d76.js";import{Q as q}from"./qrcode.vue-dff8d785.js";import{u as N}from"./vue-router-70c59f8f.js";import{d as k,I as B,m as P,g as D,a0 as H,o as i,c as u,a as c,U as K,$ as U,S as d,a1 as y,W as r,e as h,Y as v,Z as C,V as n}from"./@vue-923429e4.js";import{u as j,d as z,G,H as M,D as Q}from"./naive-ui-809e5fbb.js";import{_ as w}from"./vue-img-cutter-7be274e5.js";import"./pinia-6f3a18e1.js";import"./vue-demi-71ba0ef2.js";import"./pinia-plugin-persistedstate-4f3b1591.js";import"./axios-760d4776.js";import"./nprogress-93825526.js";import"./artplayer-dacbf558.js";import"./@vicons-ed1f5506.js";import"./pubsub-js-4eb33f76.js";/* empty css               */import"./vueuc-f6692277.js";import"./evtd-b614532e.js";import"./seemly-d1bbd19f.js";import"./@css-render-39cdbd82.js";import"./vooks-13ee1ac7.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-d3958e6a.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-c742445b.js";import"./treemate-25c27bff.js";import"./date-fns-975a2d8f.js";const T=()=>p.get("/login/qr/key"),A=t=>p.get("/login/qr/create",{params:{key:t,qrimg:!0}}),E=t=>p.get("/login/qr/check",{params:{key:t}}),R=t=>(v("data-v-17ea6d0d"),t=t(),C(),t),W={class:"code-login-box"},Y={class:"tips"},Z={class:"code-box"},F={key:0,class:"code-out"},J=R(()=>c("span",{class:"tips"},"请打开云音乐 APP 扫码登陆",-1)),O=k({__name:"CodeLogin",setup(t){const _=L(),l=N();let s=null;const a=j(),e=B({unikey:"",code:800,cookie:null,username:null}),x=P(()=>{switch(e.code){case 800:return"二维码过期或还没生成二维码";case 801:return"等待扫码";case 802:return`${e.username} 等待授权`;case 803:return"登录成功"}});async function I(){try{const o=await T();o.data.code===200?e.unikey=o.data.unikey:await Promise.reject(),(await A(e.unikey)).code!==200&&await Promise.reject()}catch{a.error("创建二维码失败 😋")}}async function f(){try{const o=await E(e.unikey);o.code===803?(e.cookie=o.cookie,S()):o.code===800?(clearInterval(s),s=null,e.username=null,e.code=800,e.cookie=""):o.code===802&&(e.username=o.nickname),e.code=o.code}catch{a.error("出错啦!!")}}function S(){a.success("登录成功!"),clearInterval(s),_.setCookie(e.cookie),_.setLogin(!0),localStorage.setItem("cookie",e.cookie),l.push("/my")}async function g(){s&&clearInterval(s);try{await I(),await f(),s=setInterval(f,1e3)}catch{a.error("出错啦!!")}}return D(g),H(()=>{clearInterval(s)}),(o,$)=>{const b=z;return i(),u("div",W,[c("span",Y,K(U(x)),1),c("div",Z,[e.code===800&&e.unikey?(i(),u("div",F," 二维码过期 ")):d("",!0),e.unikey?(i(),y(q,{key:1,size:150,level:"H",background:"#fff",foreground:"#4098fc",value:`https://music.163.com/login?codekey=${e.unikey}`},null,8,["value"])):d("",!0)]),e.code===800&&e.unikey?(i(),y(b,{key:0,size:"small",onClick:g},{default:r(()=>[h("刷新二维码")]),_:1})):d("",!0),J])}}});const X=w(O,[["__scopeId","data-v-17ea6d0d"]]),m=t=>(v("data-v-18914f0a"),t=t(),C(),t),ee={class:"page"},te=m(()=>c("img",{width:"80",src:V},null,-1)),oe=m(()=>c("div",{class:"tips"}," 接口暂未提供😎 ",-1)),se=m(()=>c("div",{class:"tips"}," 接口暂未提供😎 ",-1)),ae=k({__name:"Login",setup(t){return(_,l)=>{const s=G,a=M,e=Q;return i(),u("div",ee,[te,n(s,{style:{"text-align":"center","font-weight":"700","margin-top":"20px"}},{default:r(()=>[h(" 登录云音乐 ")]),_:1}),n(e,{type:"segment",animated:"",style:{"max-width":"500px"}},{default:r(()=>[n(a,{name:"code",tab:"二维码登录"},{default:r(()=>[n(X)]),_:1}),n(a,{name:"phone",tab:"手机号登录"},{default:r(()=>[oe]),_:1}),n(a,{name:"email",tab:"邮箱登录"},{default:r(()=>[se]),_:1})]),_:1})])}}});const Be=w(ae,[["__scopeId","data-v-18914f0a"]]);export{Be as default};
