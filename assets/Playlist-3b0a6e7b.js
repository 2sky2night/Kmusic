import{u as Re,p as T,t as me,m as He,a as g,q as We,e as ge,o as Ae,s as Ge,C as Je,v as Ke,h as Oe,i as Ye,j as Ze}from"./index-1f548d76.js";import{d as fe,o as r,a1 as c,W as a,e as d,U as p,$ as l,r as f,I as Qe,m as Xe,w as et,g as tt,c as x,a as n,V as i,F as W,a3 as A,S as v,a4 as at,Y as st,Z as ot,a9 as D}from"./@vue-923429e4.js";import{P as nt}from"./PlaylistSkeleton-321b9240.js";import{j as lt,i as it,G as rt,J as ut,K as ct,_ as dt,d as pt,F as vt,N as _t,g as mt,h as gt,f as ft,L as yt,M as ht,O as kt,P as wt}from"./naive-ui-809e5fbb.js";import{I as bt,_ as Ct}from"./vue-img-cutter-7be274e5.js";import{u as xt,a as It,g as Pt,b as St,c as $t,t as Dt}from"./index-74a80178.js";import{u as Ut,o as Lt,a as zt}from"./vue-router-70c59f8f.js";import{p as Nt}from"./index-92c9656a.js";import{o as G}from"./@vicons-ed1f5506.js";import"./pinia-6f3a18e1.js";import"./vue-demi-71ba0ef2.js";import"./pinia-plugin-persistedstate-4f3b1591.js";import"./axios-760d4776.js";import"./nprogress-93825526.js";import"./artplayer-dacbf558.js";import"./pubsub-js-4eb33f76.js";/* empty css               */import"./vueuc-f6692277.js";import"./evtd-b614532e.js";import"./seemly-d1bbd19f.js";import"./@css-render-39cdbd82.js";import"./vooks-13ee1ac7.js";import"./vdirs-b0483831.js";import"./@juggle-41516555.js";import"./css-render-d3958e6a.js";import"./@emotion-8a8e73f6.js";import"./lodash-es-c742445b.js";import"./treemate-25c27bff.js";import"./date-fns-975a2d8f.js";const jt=fe({__name:"Tag",props:{size:null,round:{type:Boolean},title:null},setup(I){const w=Math.floor(Math.random()*6+1);let _="";switch(w){case 1:_="default";break;case 2:_="primary";break;case 3:_="info";break;case 4:_="success";break;case 5:_="warning";break;case 6:_="error";break}return(P,b)=>{const S=lt;return r(),c(S,{type:l(_),size:I.size,round:I.round},{default:a(()=>[d(p(I.title),1)]),_:1},8,["type","size","round"])}}}),U=I=>(st("data-v-0cbed1de"),I=I(),ot(),I),Bt={class:"page page-layout"},Ft={key:0,class:"music-infor"},Mt={class:"cover"},Tt={class:"infor"},Vt=U(()=>n("span",null,"点击歌单名称可以修改名称",-1)),qt=U(()=>n("span",null,"评论数量 ",-1)),Et=U(()=>n("span",null,"播放数量 ",-1)),Rt=U(()=>n("span",null,"歌单分享 ",-1)),Ht={key:2,class:"playlist-subscribers"},Wt=U(()=>n("span",null,"最近收藏该歌单的用户",-1)),At={key:1,class:"list"},Gt={class:"list-title"},Jt=U(()=>n("span",null,"点击歌单名称可以修改名称",-1)),Kt={class:"user"},Ot={class:"list-time"},Yt=U(()=>n("span",null,"创建时间 ",-1)),Zt=["textContent"],Qt=U(()=>n("span",null,"更新时间 ",-1)),Xt=["textContent"],ea={key:3,class:"pagination"},ta={style:{"margin-right":"10px"}},aa={class:"container"},sa={class:"btns"},oa={class:"btns"},na={class:"btns"},la=fe({__name:"Playlist",setup(I){const w=f(""),_=f(!1),P=f(!1),b=f(null),S=f(!1),F=f(null),z=f(!1),u=Re(),s=f(null),N=f(null),h=Qe([]),k=f(!1),C=f(!0),j=f(0);let V=0;const M=f(!1),$=Ut(),q=zt(),ye=[{label:"查看大图",key:"big-photo"},{label:"修改歌单封面",key:"change-cover"}];async function he(){const o=s.value;try{await He(`真的要删除歌单 ${o.name} 吗 😭`,"提示")}catch{g("取消了删除歌单 👀","warning");return}try{await u.deletePlaylist(o.id),$.push("/")}catch{}}function ke(){b.value=null}async function we(){k.value=!0;try{const o=await We(s.value.id,b.value);o.status!==200&&await Promise.reject(),b.value.forEach(e=>{h.some((m,L,B)=>{if(m.id===e){B.splice(L,1);return}})}),h.length===0&&(_.value=!1),u.updatePlaylist(s.value.id,"count",o.body.count),b.value=null,k.value=!1,g("移除歌曲成功 😙","success")}catch{g("移除歌曲失败 😄","warning")}}const be=Xe(()=>!(b.value&&b.value.length));async function Ce(){if(!w.value)return g("歌单名称不能为空 😡","info");const o=s.value.id;S.value=!0;try{(await xt(o,w.value)).code!==200&&await Promise.reject(),s.value.name=w.value,u.updatePlaylist(o,"name",w.value),S.value=!1,P.value=!1,g("更新歌单名称成功 😉","success")}catch{g("更新歌单名称失败 🤐","warning")}}async function xe(){S.value=!0;const o=new FormData;o.append("imgFile",F.value);try{const e=await It(s.value.id,o);e.code!==200&&await Promise.reject(),s.value.coverImgUrl=e.data.url,u.updatePlaylist(s.value.id,"cover",e.data.url),z.value=!1,g("上传封面成功 😎","success"),S.value=!1}catch{g("上传封面失败 😴","warning")}}function Ie(o){F.value=o.file}function Pe(){F.value=null}function Se(o){o==="big-photo"?J():o==="change-cover"&&(z.value=!0)}function J(){Nt(s.value.coverImgUrl)}async function K(o){j.value=ge(q.query.page),k.value=!0;try{const e=await Pt(o);e.code!==200&&await Promise.reject(),e.playlist.creator||await Promise.reject(),w.value=e.playlist.name,s.value=e.playlist,V=Ae(20,s.value.trackIds.length);const m=await St(o);m.code!==200&&await Promise.reject(),N.value=m,M.value=N.value.subscribed,k.value=!1,C.value=!1,O(o)}catch{g("加载歌单失败 😰","error"),$.replace("/404")}}async function O(o){k.value=!0,h.length=0;try{const e=await $t(o,j.value);if(e.code!==200&&await Promise.reject(),h.length>0)return;e.songs.forEach((m,L)=>{h.push({...m,privilege:{...e.privileges[L]}})}),k.value=!1}catch{g("加载歌单的歌曲失败 😓","warning"),$.replace("/404")}}async function $e(){if(!u.isLogin&&!u.cookie){g("请登录后再使用此功能 😋","warning");return}let o=0;M.value?o=0:o=1,(await Dt(o,s.value.id)).code===200?(g(o?"收藏歌单成功":"取消收藏歌单成功","success"),M.value=!!o):g("收藏/取消收藏歌单失败 😅","error")}function De(o){$.push(`/discover/playlist?tag=${o}&page=1`)}function Ue(){var o;$.push(`/playlist-comment/${(o=s.value)==null?void 0:o.id}?page=1`)}function Le(){var o,e;((o=s.value)==null?void 0:o.creator.userId)===u.userData.id?$.push("/my"):$.push(`/user/${(e=s.value)==null?void 0:e.creator.userId}`)}function Y(){s.value.description&&Ge(s.value.description,"歌单简介")}return et(j,o=>{$.push({path:q.path,query:{page:o}})}),Lt(async(o,e)=>{const m=+o.params.id,L=+e.params.id;m!==L&&(C.value=!0,await K(m),C.value=!1),j.value=ge(o.query.page),O(m)}),tt(()=>{K(+q.params.id)}),(o,e)=>{var ee,te,ae,se,oe,ne,le,ie,re,ue,ce,de,pe,ve,_e;const m=Je,L=it,B=rt,Z=ut,ze=ct,Q=dt,X=Ke,y=pt,Ne=Oe,je=Ye,Be=Ze,Fe=vt,E=_t,R=mt,H=gt,Me=ft,Te=kt,Ve=wt,qe=yt,Ee=ht;return r(),x("div",Bt,[C.value?v("",!0):(r(),x("div",Ft,[n("div",Mt,[l(u).isLoginState&&l(u).userData.id===s.value.userId?(r(),c(L,{key:0,"show-arrow":!0,trigger:"click",options:ye,onSelect:Se},{default:a(()=>{var t;return[i(m,{img:(t=s.value)==null?void 0:t.coverImgUrl},null,8,["img"])]}),_:1})):(r(),c(m,{key:1,onClick:J,img:(ee=s.value)==null?void 0:ee.coverImgUrl},null,8,["img"]))]),n("div",Tt,[l(u).isLoginState&&s.value.userId===l(u).userData.id?(r(),c(Z,{key:0,trigger:"hover"},{trigger:a(()=>[i(B,{onClick:e[0]||(e[0]=t=>P.value=!0),style:{display:"inline-block"}},{default:a(()=>{var t;return[d(p((t=s.value)==null?void 0:t.name),1)]}),_:1})]),default:a(()=>[Vt]),_:1})):(r(),c(B,{key:1},{default:a(()=>{var t;return[d(p((t=s.value)==null?void 0:t.name),1)]}),_:1})),i(ze,null,{default:a(()=>[d("歌单简介")]),_:1}),n("div",{class:"desc",onClick:Y,style:{cursor:"pointer"}},[i(Q,{style:{width:"250px"},"line-clamp":4,tooltip:!1},{default:a(()=>{var t;return[d(p(((t=s.value)==null?void 0:t.description)||"无"),1)]}),_:1})]),e[1]||(D(-1),e[1]=n("div",{class:"tags"},[(r(!0),x(W,null,A((te=s.value)==null?void 0:te.tags,t=>(r(),c(jt,{onClick:()=>De(t),style:{"margin-right":"5px",cursor:"pointer"},key:t,title:t,round:!0,size:"small"},null,8,["onClick","title"]))),128))]),D(1),e[1]),e[2]||(D(-1),e[2]=n("div",{class:"list-data"},[n("div",null,[qt,n("span",null,p(l(T)(N.value.commentCount)),1)]),n("div",null,[Et,n("span",null,p(l(T)(N.value.playCount)),1)]),n("div",null,[Rt,n("span",null,p(l(T)(N.value.shareCount)),1)])]),D(1),e[2]),(ae=s.value)!=null&&ae.subscribers.length?(r(),x("div",Ht,[Wt,n("ul",null,[(r(!0),x(W,null,A((se=s.value)==null?void 0:se.subscribers,t=>(r(),x("li",{key:t.userId},[i(X,{img:t.avatarUrl,id:t.userId,name:t.nickname,height:30,width:30},null,8,["img","id","name"])]))),128))])])):v("",!0)])])),C.value?v("",!0):(r(),x("div",At,[n("div",Gt,[l(u).isLoginState&&s.value.userId===l(u).userData.id?(r(),c(Z,{key:0,trigger:"hover"},{trigger:a(()=>[i(B,{onClick:e[3]||(e[3]=t=>P.value=!0),style:{display:"inline-block"}},{default:a(()=>{var t;return[d(p((t=s.value)==null?void 0:t.name),1)]}),_:1})]),default:a(()=>[Jt]),_:1})):(r(),c(B,{key:1},{default:a(()=>{var t;return[d(p((t=s.value)==null?void 0:t.name),1)]}),_:1})),n("div",Kt,[i(X,{width:30,height:30,id:(oe=s.value)==null?void 0:oe.creator.userId,name:(ne=s.value)==null?void 0:ne.creator.nickname,img:(le=s.value)==null?void 0:le.creator.avatarUrl},null,8,["id","name","img"]),n("span",{onClick:Le,class:"text",style:{"margin-left":"5px"}},p((ie=s.value)==null?void 0:ie.creator.nickname),1)]),n("div",Ot,[e[4]||(D(-1),e[4]=n("div",null,[Yt,n("span",{textContent:p(l(me)(s.value.createTime))},null,8,Zt)]),D(1),e[4]),e[5]||(D(-1),e[5]=n("div",null,[Qt,n("span",{textContent:p(l(me)(s.value.updateTime))},null,8,Xt)]),D(1),e[5]),l(u).isLoginState&&l(u).userData.id!==((re=s.value)==null?void 0:re.creator.userId)?(r(),c(y,{key:0,strong:"",secondary:"",onClick:at($e,["stop"]),size:"small",type:M.value?"warning":"default"},{default:a(()=>[d(p(M.value?"已收藏":"收藏"),1)]),_:1},8,["onClick","type"])):v("",!0),l(u).isLoginState&&l(u).userData.id===((ue=s.value)==null?void 0:ue.creator.userId)&&h.length?(r(),c(y,{key:1,loading:k.value,strong:"",secondary:"",onClick:e[6]||(e[6]=t=>_.value=!0),size:"small",type:"success"},{default:a(()=>[d(" 移除当前页的歌曲 ")]),_:1},8,["loading"])):v("",!0),l(u).isLoginState&&l(u).userData.id===((ce=s.value)==null?void 0:ce.creator.userId)?(r(),c(y,{key:2,strong:"",secondary:"",size:"small",style:{"margin-left":"5px"},onClick:he},{default:a(()=>[d("删除歌单")]),_:1})):v("",!0),(de=s.value)!=null&&de.description?(r(),c(y,{key:3,strong:"",secondary:"",size:"small",class:"check-desc",onClick:Y,style:{"margin-left":"5px"}},{default:a(()=>[d(" 查看简介 ")]),_:1})):v("",!0),i(y,{onClick:Ue,size:"small",strong:"",secondary:"",type:"info",style:{"margin-left":"5px"}},{default:a(()=>{var t;return[d(" 评论 "+p(l(T)((t=N.value)==null?void 0:t.commentCount)),1)]}),_:1})])]),!k.value&&h.length?(r(),c(Ne,{key:0,"song-list":h},null,8,["song-list"])):v("",!0),h.length===0&&!k.value?(r(),c(je,{key:1,description:"当前页没有任何一首歌曲 😉","show-btn":!0})):v("",!0),k.value?(r(),c(Be,{key:2,length:20})):v("",!0),l(V)>1&&h.length?(r(),x("div",ea,[n("span",ta,"总共 "+p(s.value.trackIds.length)+" 项",1),i(Fe,{"page-slot":7,page:j.value,"onUpdate:page":e[7]||(e[7]=t=>j.value=t),"page-count":l(V)},null,8,["page","page-count"])])):v("",!0)])),C.value?(r(),c(nt,{key:2})):v("",!0),l(u).isLoginState&&!C.value&&l(u).userData.id===((pe=s.value)==null?void 0:pe.creator.userId)?(r(),c(H,{key:3,show:z.value,"onUpdate:show":e[10]||(e[10]=t=>z.value=t),onAfterLeave:Pe},{default:a(()=>[i(R,{style:{width:"60%","max-width":"350px"},title:"歌单封面上传",bordered:!1,role:"dialog","aria-modal":"true"},{"header-extra":a(()=>[i(E,{class:"text",size:"30",onClick:e[8]||(e[8]=t=>z.value=!1)},{default:a(()=>[i(l(G))]),_:1})]),footer:a(()=>[n("div",sa,[i(y,{strong:"",secondary:"",style:{"margin-right":"5px"},onClick:e[9]||(e[9]=t=>z.value=!1)},{default:a(()=>[d("取消")]),_:1}),i(y,{strong:"",secondary:"",type:"primary",onClick:xe,loading:S.value},{default:a(()=>[d("确认")]),_:1},8,["loading"])])]),default:a(()=>[n("div",aa,[i(l(bt),{onCutDown:Ie,boxWidth:350,boxHeight:300},{open:a(()=>[i(y,{type:F.value?"primary":"default"},{default:a(()=>[d(p(F.value?"已选择图片":"选择图片"),1)]),_:1},8,["type"])]),_:1})])]),_:1})]),_:1},8,["show"])):v("",!0),l(u).isLoginState&&!C.value&&l(u).userData.id===((ve=s.value)==null?void 0:ve.creator.userId)?(r(),c(H,{key:4,show:P.value,"onUpdate:show":e[14]||(e[14]=t=>P.value=t)},{default:a(()=>[i(R,{style:{width:"60%","max-width":"350px"},title:"歌单名称修改",bordered:!1,role:"dialog","aria-modal":"true"},{"header-extra":a(()=>[i(E,{class:"text",size:"30",onClick:e[11]||(e[11]=t=>P.value=!1)},{default:a(()=>[i(l(G))]),_:1})]),footer:a(()=>[n("div",oa,[i(y,{strong:"",secondary:"",style:{"margin-right":"5px"},onClick:e[13]||(e[13]=t=>P.value=!1)},{default:a(()=>[d("取消")]),_:1}),i(y,{strong:"",secondary:"",type:"primary",onClick:Ce,loading:S.value},{default:a(()=>[d("确认")]),_:1},8,["loading"])])]),default:a(()=>[i(Me,{value:w.value,"onUpdate:value":e[12]||(e[12]=t=>w.value=t)},null,8,["value"])]),_:1})]),_:1},8,["show"])):v("",!0),l(u).isLoginState&&!C.value&&l(u).userData.id===((_e=s.value)==null?void 0:_e.creator.userId)?(r(),c(H,{key:5,show:_.value,"onUpdate:show":e[18]||(e[18]=t=>_.value=t),onAfterLeave:ke},{default:a(()=>[i(R,{style:{width:"80%","max-width":"450px"},title:"移除歌曲",bordered:!1,role:"dialog","aria-modal":"true"},{"header-extra":a(()=>[i(E,{class:"text",size:"30",onClick:e[15]||(e[15]=t=>_.value=!1)},{default:a(()=>[i(l(G))]),_:1})]),footer:a(()=>[n("div",na,[i(y,{style:{"margin-right":"5px"},strong:"",secondary:"",onClick:e[17]||(e[17]=t=>_.value=!1)},{default:a(()=>[d("取消")]),_:1}),i(y,{loading:k.value,type:"primary",strong:"",secondary:"",onClick:we,disabled:l(be)},{default:a(()=>[d("确认")]),_:1},8,["loading","disabled"])])]),default:a(()=>[i(Ee,{value:b.value,"onUpdate:value":e[16]||(e[16]=t=>b.value=t)},{default:a(()=>[i(qe,{"y-gap":8,cols:2},{default:a(()=>[(r(!0),x(W,null,A(h,t=>(r(),c(Ve,{key:t.id},{default:a(()=>[i(Te,{value:t.id},{default:a(()=>[i(Q,{style:{"max-width":"150px"}},{default:a(()=>[d(p(t.name),1)]),_:2},1024)]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["show"])):v("",!0)])}}});const Fa=Ct(la,[["__scopeId","data-v-0cbed1de"]]);export{Fa as default};
